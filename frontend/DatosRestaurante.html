<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="autor" content="Javier Susin">
    <meta name="description" content="Pantalla destinada al registro de un local nuevo para la aplicación BiteFinder">
    <meta name="keywords" content="HTML, CSS, JavaScript">

    <!--Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="./img/favicon.png">
    <!--Fuentes de letras-->
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">

    <title>Mi local - BiteFinder</title>
    <link href="RegistrarseUSUARIO.css" rel="stylesheet">
    <link rel="stylesheet" href="Registrarse.css">
</head>

    <!-- Barra de navegacion -->
    <nav class="navbar navbar-expand-xl navbar-light" style="padding: 2rem; background-color: #d3e71a">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-toggler"
                aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar-toggler">
                <a class="navbar-brand">
                    <img src="./img/favicon.png" width="100px" alt="Logo de BiteFinder">
                </a>
                <h1 class="navbar-titulo" style="font-family: 'Lobster'; font-size: 60px; position: absolute; left: 50%; transform: translateX(-50%); text-align: center;">
                    BiteFinder
                  </h1>
                <ul class="navbar-nav d-flex justify-content-center align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" style="font-family: 'Oswald'; font-size: 30px;"
                            href="Inicio.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <!-- Si clican en el llevará a la parte inferior de la página, a la seccion de contacto-->
                        <a class="nav-link" style="font-family: 'Oswald'; font-size: 30px;"
                            href="#contacto">Contacto</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" style="font-family: 'Oswald'; font-size: 30px;" href="Home.html">Iniciar
                            Sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

<!-- Main Section -->
<main style="background-color: #337ab7;">
    <section class="local-section">
        <h2 style="font-family: 'Oswald'; font-size: 36px;">Modifique los datos de su local:</h2>
        
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
              <h2 class="accordion-heade m-0">
                <button class="accordion-button" style="font-family: 'Oswald'; font-size: 24px; color:  red;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  <p><strong>IMPORTANTE: </strong> Lea estás instrucciones antes de realizar los cambios. </p>
                </button>
              </h2>
              <div id="collapseOne" class="accordion-collapse collapse show" style="font-family: 'Oswald'; font-size: 20px;"  data-bs-parent="#accordionExample">
                <div class="accordion-body">
                  <strong>Rellene todos los campos obligatiorios marcados con (*).</strong> A continuación están presentes los datos relaitvos a su local, si desea realizar alguna modificación en alguno de ellos, simplemente reescribelo, tenga en cuenta que una vez realizados los cambios no hay vuelta atrás, por lo que revise los cambios encarecidamente antes de guardarlos.
                </div>
              </div>
            </div>
        </div>
        
        <form id = "form" class="local-form">

            <div class="input-group">
                <label for="nombreRestaurante" style="font-family: 'Oswald'; font-size: 26px;">Nombre del
                    restaurante <strong style="color: red;">*</strong></label>
                <input type="text" id="nombreRestaurante" placeholder="Ingrese el nombre del local"
                    style="font-family: 'Oswald'; font-size: 20px;">
            </div>

            <div class="input-group">
                <label for="emailContacto" style="font-family: 'Oswald'; font-size: 26px;">Email de contacto<strong style="color: red;">*</strong></label>
                <input type="email" id="emailContacto" placeholder="Ingrese un correo electrónico de contacto para el restaurante"
                    style="font-family: 'Oswald'; font-size: 20px;">
            </div>

            <label for="descripcion" style="font-family: 'Oswald'; font-size: 26px;">Descripción del local<strong style="color: red;">*</strong></label>
            <textarea id="descripcion" placeholder="Describe tu local"
                style="font-family: 'Oswald'; font-size: 20px;"></textarea>

            <div class="input-group">
                <label for="nombreRestaurante" style="font-family: 'Oswald'; font-size: 26px;">Categoría del local <strong style="color: red;">*</strong></label>
                <input type="text" id="categoriaLocal" placeholder="Ingrese la categoría del local"
                    style="font-family: 'Oswald'; font-size: 20px;">
            </div>

            <label for="telefono" style="font-family: 'Oswald'; font-size: 26px;">Teléfono<strong style="color: red;">*</strong></label>
            <input type="tel" id="telefono" placeholder="+14155552675"
                style="font-family: 'Oswald'; font-size: 20px;">

            <label for="url" style="font-family: 'Oswald'; font-size: 26px;">URL <strong style="color: red;">*</strong></label>
            <input type="url" id="url" placeholder="Ingrese su URL (opcional)"
                style="font-family: 'Oswald'; font-size: 20px;">

            <label for="aforo" style="font-family: 'Oswald'; font-size: 26px;">Aforo<strong style="color: red;">*</strong></label>
            <input type="number" id="aforo" value="0">

            <div class="input-group">
                <label for="ubicacion" style="font-family: 'Oswald'; font-size: 26px;">Ubicación<strong style="color: red;">*</strong></label>
                <input type="text" id="ubicacion" placeholder="Ingrese la ubicación del restaurante"
                    style="font-family: 'Oswald'; font-size: 20px;">
            </div>
            
            <label for="foto" style="font-family: 'Oswald'; font-size: 26px;">Foto local <strong style="color: red;">*</strong></label>
            <input type="url" id="foto" placeholder="Ingrese una foto del local (opcional)"
                style="font-family: 'Oswald'; font-size: 20px;">
                
            <!-- Horarios de apertura y cierre para los 7 días de la semana -->
            <div class="horarios">
                <h3 style="font-family: 'Oswald'; font-size: 26px;">Horarios de apertura y cierre:<strong style="color: red;">*</strong></h3>
                
                <!-- Horarios para cada día -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Lunes</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="lunesMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="lunesMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="lunesNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="lunesNocheCierre">
                </div>
                
                <!-- Martes -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Martes</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="martesMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="martesMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="martesNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="martesNocheCierre">
                </div>
                
                <!-- Miércoles -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Miércoles</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="miercolesMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="miercolesMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="miercolesNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="miercolesNocheCierre">
                </div>

                <!-- Jueves -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Jueves</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="juevesMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="juevesMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="juevesNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="juevesNocheCierre">
                </div>
                
                <!-- Viernes -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Viernes</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="viernesMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="viernesMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="viernesNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="viernesNocheCierre">
                </div>
                
                <!-- Sábado -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Sábado</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="sabadoMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="sabadoMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="sabadoNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="sabadoNocheCierre">
                </div>

                <!-- Domingo -->
                <div class="dia-horario">
                    <h4 style="font-family: 'Oswald'; font-size: 24px;">Domingo</h4>
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Apertura</label>
                    <input type="time" name="domingoMananaApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Mañana - Cierre</label>
                    <input type="time" name="domingoMananaCierre">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Apertura</label>
                    <input type="time" name="domingoNocheApertura">
                    <label style="font-family: 'Oswald'; font-size: 20px;">Noche - Cierre</label>
                    <input type="time" name="domingoNocheCierre">
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="font-family: 'Oswald'; font-size: 20px;">Guardar
                local</button>
        </form>
    </section>
</main>

    <!-- Seccion de contacto -->
    <section id="contacto" class="contacto">
        <div class="contact-section">
            <div>
                <div class="icon">
                    <img src="img/correo.png" alt="Email">
                </div>
                <h3 style="font-family: 'Oswald'; font-size: 30px;">CONTÁCTANOS</h3>
                <p style="font-family: 'Oswald'; font-size: 20px;">Nuestro equipo está para ayudar</p>
                <a href="mailto:admin@BiteFinder.com"
                    style="font-family: 'Oswald'; font-size: 20px;">admin@BiteFinder.com</a>
            </div>
            <div>
                <div class="icon">
                    <img src="img/localizacion.png" alt="Oficina">
                </div>
                <h3 style="font-family: 'Oswald'; font-size: 30px;">OFICINA</h3>
                <p style="font-family: 'Oswald'; font-size: 20px;">Nuestras oficinas en caso de dudas</p>
                <p><a href="https://maps.google.com/?q=Avenida%20Paraíso%20nº14" target="_blank"
                        style="font-family: 'Oswald'; font-size: 20px;">Avenida Paraíso nº14</a>
                </p>
            </div>
            <div>
                <div class="icon">
                    <img src="img/telefono.png" alt="Teléfono">
                </div>
                <h3 style="font-family: 'Oswald'; font-size: 30px;">TELÉFONO</h3>
                <p style="font-family: 'Oswald'; font-size: 20px;">Lunes-Viernes de 8am a 5am</p>
                <a href="tel:+976675452" style="font-family: 'Oswald'; font-size: 20px;">+976 675 452</a>
            </div>
        </div>

       
    </section>

     <script>


document.addEventListener('DOMContentLoaded', async () => {
    const jefe = sessionStorage.getItem('username');  // Recupera el nombre del jefe desde sessionStorage
    console.log(jefe);  // Verifica si el jefe es correcto

    if (!jefe) {
        alert('No se ha encontrado el nombre de usuario. Por favor, vuelva a iniciar sesión.');
        return;
    }

    try {
        const response = await fetch(`http://localhost:3000/api/mostrarFormularioRestaurante?jefe=${jefe}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const restaurante = await response.json();
            console.log(restaurante);  // Verifica qué datos estás recibiendo
            // console.log('Categoría:', restaurante.categoria);


            // Rellenar los campos del formulario con los datos del restaurante
            document.getElementById('nombreRestaurante').value = restaurante.nombre || '';
            document.getElementById('emailContacto').value = restaurante.email || '';
            
            // Para textarea usa innerHTML en lugar de value
            document.getElementById('descripcion').innerHTML = restaurante.descripcion || ''; 
            
            document.getElementById('categoriaLocal').value = restaurante.categoria || '';
            document.getElementById('telefono').value = restaurante.telefono || '';
            document.getElementById('url').value = restaurante.URLweb || '';
            document.getElementById('aforo').value = restaurante.aforo || 0;
            document.getElementById('ubicacion').value = restaurante.ubicacion || '';
            document.getElementById('foto').value = restaurante.fotos || '';
        } else {
            alert('No se pudieron cargar los datos del restaurante');
        }
    } catch (error) {
        console.error('Error al obtener los datos del restaurante:', error);
        alert('Hubo un problema al intentar cargar los datos del restaurante. Inténtalo más tarde.');
    }
});
    </script> 
    <script>
        document.getElementById('form').addEventListener('submit', async (e) => {
    e.preventDefault();  // Prevenir la recarga de la página al enviar el formulario

    const jefe = sessionStorage.getItem('username');  // Recuperar el jefe desde sessionStorage
    const nombre = document.getElementById('nombreRestaurante').value;
    const email = document.getElementById('emailContacto').value;
    const descripcion = document.getElementById('descripcion').value;
    const categoria = document.getElementById('categoriaLocal').value;
    const telefono = document.getElementById('telefono').value;
    const url = document.getElementById('url').value;
    const aforo = document.getElementById('aforo').value;
    const ubicacion = document.getElementById('ubicacion').value;
    const fotos = document.getElementById('foto').value;

    try {
        const response = await fetch('http://localhost:3000/api/actualizarRestaurante', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ jefe, nombre, email, descripcion, categoria, telefono, url, aforo, ubicacion, fotos })
        });

        if (response.ok) {
            alert('Restaurante actualizado exitosamente');
        } else {
            const errorData = await response.json();
            alert(`Error al actualizar el restaurante: ${errorData.error}`);
        }
    } catch (error) {
        console.error('Error al enviar la actualización:', error);
        alert('Hubo un error al intentar actualizar el restaurante. Inténtalo más tarde.');
    }
});

    </script>
     

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>